function [MFt, MFf] = matchedFilter(signal_f,  Hf, fs) 
% function [MFt, MFf] = matchedFilter(signal_f,  Hf, fs) 
% calculates the (complex) matched filter output in time and frequency for
% an input signal in the frequency domain, when matched with a system
% function H. 
% INPUTS    :-signal_f, input signal in frequency domain, obtained by
%             taking the FFT (in our acoustic software suite: IFFT) of the
%             input time series. 
%            -Hf: Complex frequency spectrum (or IFFT/FFT) of the matched
%            signal. Must be of the same length as signal input 
%            -fs: sampling frequency. 
% OUTPUTS   :-MFt, MFf: time and frequency representation of the
%               matched-filter output. 
% Example: 
 [st1, Sf1, rst1, rSf1] = getLFM(8000, 1, 2, 4, 390, 440);
 [Ht, Hf, ~, ~] = getLFM(8000, 0, 1, 4, 390, 440); 
% [MFt, MFf] = matchedFilter(Sf1, H, 8000); 
% figure; subplot(2, 1, 1); plot(real(st1)); subplot(2, 1, 2); plot(real(MFt)); 
%
% Written by DD Tran. Last updated Aug 9, 2013. 

if nargin > 2 
    T = length(Hf)/fs; %signal duration; 
else 
    T = length(Hf);  
end 

MFf = signal_f.*conj(H); 
MFt = fft(MFf)/T; %divided by T for proper energy normalization and satisfying the PArseval's theorem. 

end 
